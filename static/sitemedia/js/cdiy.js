var cmr=$("#contract-maker");$(function(){$("#contract_title").blur(function(){$("#ctitle").val($(this).val())});cmr.on("click","h2",function(){var isStd=false;var stdFlag="";var thisItem=$(this);var chapid=thisItem.data("chapid");if(!chapid){chapid=thisItem.attr("data-std-chapid");isStd=true;stdFlag="std-"}var thisI=$("#i-"+stdFlag+chapid);var nosel=1;if(thisI.hasClass("fa-check-square")){thisI.removeClass("fa-check-square").addClass("fa-square-o");$("#cm-ib-"+stdFlag+chapid).hide();$("#nosel-"+stdFlag+"chapid"+chapid).val("1");nosel=1;if(stdFlag=="std-"){for(i=0;i<availChapidGlobal_std.length;i++){if(availChapidGlobal_std[i]==chapid){availChapidGlobal_std.splice(i,1)}}}else{for(i=0;i<availChapidGlobal.length;i++){if(availChapidGlobal[i]==chapid){availChapidGlobal.splice(i,1)}}}}else{if(thisI.hasClass("fa-square-o")){thisI.removeClass("fa-square-o").addClass("fa-check-square");$("#cm-ib-"+stdFlag+chapid).show();$("#nosel-"+stdFlag+"chapid"+chapid).val("0");nosel=0;ichapid=parseInt(chapid);if(!inarray([ichapid],availChapidGlobal)&&stdFlag==""){availChapidGlobal.push(ichapid)}else{if(!inarray([ichapid],availChapidGlobal_std)&&stdFlag=="std-"){availChapidGlobal_std.push(ichapid)}}}}setToAidDepds(stdFlag,chapid);var tomechapids=thisItem.data("tomechapids");if(tomechapids!=""){setToChapidDepds(nosel,stdFlag,chapid,tomechapids)}}).on("click","input[type='checkbox']",setTheAidDepds).on("click","input[type='radio']",setTheAidDepds).on("keydown","input[type='text']",tabToNext);$("#cm-peoples .cm-p-sel").click(function(){var radio=$(this);var cpid=radio.attr("data-cpid");var val=$(this).val();switchPeople(val,cpid)});cmr.find("input[data-type='D']").click(setRelateSel).datepicker({showAnim:"fadeIn",dateFormat:"yy年m月d日"});cmr.find("input[data-type='L']").click(setRelateSel).click(adjustInputLen).keydown(adjustInputLen).keydown();$("#sign-dt").datepicker({showAnim:"fadeIn",dateFormat:"yy年m月d日"});$(".cm-peoples-item").hover(function(){var cpid=$(this).attr("id");$("#"+cpid+"ctrl").fadeIn(200)},function(){var cpid=$(this).attr("id");$("#"+cpid+"ctrl").fadeOut(200)});$(".cm-p-add").hover(function(){var cpid=$(this).attr("id");$("#"+cpid+"-cont").fadeIn(200)},function(){var cpid=$(this).attr("id");$("#"+cpid+"-cont").fadeOut(200)});$("#pay-method > a ").click(function(){$("#pay-method>.sel").removeClass("sel");$(this).addClass("sel");$("#modal-mathod").val($(this).data("channel"));$(".p1").hide();$(".p2").show();isPaying=true;$("#modal-mpf").submit()});$("#changemethod").click(function(){$(".p1").show();$(".p2").hide()});$("#chongQa").click(function(){window.location.reload()});$("#chongFin").click(verifyMPaid);$(".p2").hide();$("#modalMP").on("hidden.bs.modal",function(){isMpShow=false;if(isPaying&&!isProPaid){verifyMPaid()}});$(".tablediv").each(function(){var tablediv=$(this);var tid=tablediv.data("tableid");var startrow=tablediv.data("startrow");var startcol=tablediv.data("startcol");var mergconf=tablediv.data("mergconf");var tdata=tablediv.data("tdata");mergconfObj=null;if(mergconf!=""){mergconfObj=eval(mergconf)}$("#table_"+tid).handsontable({startRows:startrow,startCols:startcol,data:tdata,rowHeaders:true,mergeCells:mergconfObj||true,colHeaders:true,manualColumnResize:true,manualRowResize:true,contextMenu:true})})});var isMpShow=false;var isPaying=false;function verifyMPaid(){$.post("/diy/needmore/verify",{oid:$("#modal-oid").val(),cid:$("#modal-cid").val()},function(a){if(a&&a.r==1&&a.p==1){if(isMpShow){$("#modalMP").modal("hide")}isProPaid=true;isPaying=false;$("#pri-cont").hide();$("#pri-lock").css("color","#ccc").removeClass("fa-lock").addClass("fa-unlock");switchProArea()}else{showMsg("支付未成功到账，请等待再试")}},"json")}function tabToNext(c){if(c.keyCode=="37"||c.keyCode=="38"){var b=cmr.find(":text");var a=b.index(this);if(a==0){return}else{b[a-1].focus();b[a-1].select()}}else{if(c.keyCode=="39"||c.keyCode=="40"){var b=cmr.find(":text");var a=b.index(this);if(a==b.length-1){return}else{b[a+1].focus();b[a+1].select()}}}}function switchPeople(b,a){if(b=="1"||b=="3"){$("#pname"+a).html("　　名称");$("#pdaibiao"+a).html("签约代表")}else{$("#pname"+a).html("　　姓名");$("#pdaibiao"+a).html("身份证号")}}function addMorePeople(b){var f=parseInt($("#pblock"+b+"num").val());if(isNaN(f)){return}var e=parseInt($("#pblock"+b+"max").val());var d=$("#pblock"+b+"more");var a="";var c=$("#ptitle"+b).text();c=c.substring(0,c.length-1);for(i=e+1;i<=e+f;i++){a+="<div class='ptitle-block-a' id='ptb"+b+"-"+i+"'><span class='ptitle'>"+c+"<a href='javascript:togglePInput("+b+","+i+");'><i class='fa fa-pencil'></i></a>：</span><label class='radio-inline'><input type='radio' class='cm-p-sel' data-cpid='"+b+"-"+i+"' name='people"+b+"-"+i+"' value='1' checked='checked'>公司  </label><label class='radio-inline'><input type='radio' class='cm-p-sel' data-cpid='"+b+"-"+i+"' name='people"+b+"-"+i+"' value='2'>个人  </label><label class='radio-inline'><input type='radio' class='cm-p-sel' data-cpid='"+b+"-"+i+"' name='people"+b+"-"+i+"' value='3'>其它组织  </label> <a href='javascript:delpeople("+b+","+i+")' class='cm-p-add-s'><i class='fa fa-minus'></i> 删除</a></div>";a+="<div class='cm-peoples-input' id='pblock-input"+b+"-"+i+"'><p><span id='pname"+b+"-"+i+"'>　　名称</span>：<input name='pname"+b+"-"+i+"'></p><p><span id='pdaibiao"+b+"-"+i+"'>签约代表</span>：<input name='pdaibiao"+b+"-"+i+"'></p><div class='clearfix'></div></div>"}$("#pblock"+b+"max").val(e+f);d.append(a);for(i=e+1;i<=e+f;i++){$("#ptb"+b+"-"+i+" .cm-p-sel").click(function(){var k=$(this);var h=k.attr("data-cpid");var l=$(this).val();switchPeople(l,h)})}}function togglePInput(a,b){if(b==0){$("#pblock-input"+a).toggle()}else{$("#pblock-input"+a+"-"+b).toggle()}}function delpeople(a,b){$("#ptb"+a+"-"+b).remove();$("#pblock-input"+a+"-"+b).remove()}function adjustInputLen(){var d=$(this);var a=d.val();if(gblen(a)>3){var c=parseInt($(this).css("font-size"));if(isNaN(c)){c=18}else{c=c+2}var b=gblen(a)*c/2;if(d.width()<b){d.width(b)}}}function setRelateSel(c){var b=$(this).attr("name");var a=b.split("-");var k=0;var e="";if(b.indexOf("std-")>0){k=a[3];e="std-"}else{k=a[2]}if(k.indexOf("c")==-1){if($("#"+e+k).length>0){$("#"+e+k).prop("checked",true)}else{$(this).parent().find("input[type='checkbox']").prop("checked",true)}var h=$(this).parent().parent().parent().attr("id");var f=h.substr(6);if(e=="std-"){f=h.substr(10)}setToAidDepds(e,f)}else{var d=k.substr(1);setSelByChapid(e,d)}c.stopPropagation()}function setTheAidDepds(){var b=$(this);var a=b.parent().parent().parent().attr("id");if(typeof(a)=="undefined"){return}var c="";var d=a.substr(6);if(a.indexOf("std-")>0){c="std-";d=a.substr(10)}setToAidDepds(c,d)}function setToAidDepds(f,e){var a=$("#ans-group"+f+e);var d="";var c="";var h=null;var k=null;a.find("input[type='checkbox']").each(function(){var l=$(this);var n=l.data("tomeaids");if(typeof(n)=="undefined"||n==""){return}if(l.prop("checked")){d+=n+","}else{c+=n+","}});a.find("input[type='radio']").each(function(){var l=$(this);var n=l.data("tomeaids");if(typeof(n)=="undefined"||n==""){return}if(l.prop("checked")){d+=n+","}else{c+=n+","}});if($("#nosel-"+f+"chapid"+e).val()==1){c=c+d;d=""}if(d!=""){d=d.substring(0,d.length-1);h=d.split(",");for(i=0;i<h.length;i++){var b=h[i];if(b!=""&&b!=e){showByChapid(f,b)}}}if(c!=""){c=c.substring(0,c.length-1);k=c.split(",");for(i=0;i<k.length;i++){var b=k[i];if(b!=""&&b!=e){hideByChapid(f,b)}}}}function setToChapidDepds(b,d,e,a){a=a+"";if(a==""){return}var f=a.split(",");for(j=0;j<f.length;j++){var c=f[j];if(c==""||c==e){return}if(b==1){hideByChapid(d,c)}else{showByChapid(d,c)}}}function hideByChapid(b,a){if($("#ans-group"+b+a).length==0){return}$("#ans-group"+b+a).hide();$("#cm-ib-"+b+a).hide();if($("#nosel-"+b+"chapid"+a).val()==1){return}$("#nosel-"+b+"chapid"+a).val("1");var d=$("#i-"+b+a);d.removeClass("fa-check-square").addClass("fa-square-o");if(b=="std-"){for(g=0;g<availChapidGlobal_std.length;g++){if(availChapidGlobal_std[g]==a){availChapidGlobal_std.splice(g,1)}}}else{for(g=0;g<availChapidGlobal.length;g++){if(availChapidGlobal[g]==a){availChapidGlobal.splice(g,1)}}}setTimeout(function(){setToAidDepds(b,a)},0);var c=$("#h-"+b+a).data("tomechapids");if(c!=""){setTimeout(function(){setToChapidDepds(1,b,a,c)},0)}}function showByChapid(h,l){if($("#ans-group"+h+l).length==0){return}var p=$("#h-"+h+l);var a=false;var f=false;var e=p.data("tochapids")+"";if(e==""){f=true}else{var o=e.split(",");if(hasSelected(h,o)){f=true}}if(f){var c=p.data("toaids")+"";if(c==""){a=true}else{var n=c.split(",");for(m=0;m<n.length;m++){var d=n[m];if(!$("#"+h+d).prop("checked")){a=false;break}}a=true}}if(!a){return}$("#ans-group"+h+l).show();if($("#nosel-"+h+"chapid"+l).val()==0){return}var k=$("#i-"+h+l);var b=k.data("ds");if(b==1){k.removeClass("fa-square-o").addClass("fa-check-square");$("#nosel-"+h+"chapid"+l).val("0");$("#cm-ib-"+h+l).show();l=parseInt(l);if(!inarray([l],availChapidGlobal)&&h==""){availChapidGlobal.push(l)}else{if(!inarray([l],availChapidGlobal_std)&&h=="std-"){availChapidGlobal_std.push(l)}}setTimeout(function(){setToAidDepds(h,l)},0);var q=$("#h-"+h+l).data("tomechapids");if(q!=""){setTimeout(function(){setToChapidDepds(0,h,l,q)},0)}}}function hasSelected(b,c){var a=false;if(b=="std-"&&inarray(c,availChapidGlobal_std)){a=true}else{if(b==""&&inarray(c,availChapidGlobal)){a=true}}return a}function setSelByChapid(b,a){if($("#nosel-"+b+"chapid"+a).val()==0){return}$("#nosel-"+b+"chapid"+a).val("0");var d=$("#i-"+b+a);d.removeClass("fa-square-o").addClass("fa-check-square");setToAidDepds(b,a);var c=$("#h-"+b+a).data("tomechapids");if(c!=""){setToChapidDepds(0,b,a,c)}}function inarray(a,h){var b=false;var c=0;for(var e=0;e<a.length;e++){var f=a[e];for(var d=0;d<h.length;d++){if(f==h[d]){c++;break}}}if(c==a.length){b=true}return b}function switchMoreArea(){var a=$("#showMoreArea").val();if(a=="0"){$("#showMoreArea").val("1");$("#cm-more-area").slideDown(200);$("#cm-more-ctrl-a").html("收起标准条款　");$("#cm-more-ctrl-a-m").removeClass("fa-angle-right").addClass("fa-angle-down");$("#switchStdAllBt").slideDown(200);$("#cm-more-bt2").show()}else{if(a=="1"){$("#showMoreArea").val("0");$("#cm-more-area").slideUp(200);$("#switchStdAllBt").hide();$("#cm-more-ctrl-a").html("选择标准条款　");$("#cm-more-ctrl-a-m").removeClass("fa-angle-down").addClass("fa-angle-right");$("#cm-more-bt2").hide()}}}var isProPaid=false;var isNeedMP=false;function switchProArea(){if(!hasLogin){$("#alertRegTipsCont").html("悦合同温馨提示：请登录后使用该功能");$("#alertRegTips").show();canLoginCallBack=true;isNeedMP=true;$("#modalReg").modal("show");return}var a=$("#p3").val();var b=$("#showProArea").val();if(b=="0"&&((a>0&&isProPaid)||a==0)){$("#showProArea").val("1");$("#cm-pro-area").slideDown(200);$("#cm-pro-ctrl-a").html("收起　");$("#cm-pro-ctrl-a-m").removeClass("fa-angle-right").addClass("fa-angle-down");$("#cm-pro-bt2").show()}else{if(a>0&&!isProPaid){$("#modalMP").modal("show");isMpShow=true}else{if(b=="1"){$("#showProArea").val("0");$("#cm-pro-area").slideUp(200);$("#cm-pro-ctrl-a").html("更多专业化的选项　");$("#cm-pro-ctrl-a-m").removeClass("fa-angle-down").addClass("fa-angle-right");$("#cm-pro-bt2").hide()}}}}var isStdSelAll=false;function switchStdAll(){if(isStdSelAll){unselStdAll()}else{selStdAll()}}function unselStdAll(){var a=$("#cm-more-area");a.find(".fa-check-square").click();isStdSelAll=false;$("#switchStdAllBt .fa").removeClass("fa-check-square").addClass("fa-square-o");$("#switchStdAllBt2 .fa").removeClass("fa-check-square").addClass("fa-square-o")}function selStdAll(){var a=$("#cm-more-area");a.find(".fa-square-o").click();isStdSelAll=true;$("#switchStdAllBt .fa").removeClass("fa-square-o").addClass("fa-check-square");$("#switchStdAllBt2 .fa").removeClass("fa-square-o").addClass("fa-check-square")}function loginCallBack(){hasLogin=true;$("#modalLogin").modal("hide");if(!isNeedMP){submitDIY()}else{switchProArea()}};